<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Juego de Reciclaje</title>
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#ebf9e6;color:#0b3d1b}
    .game-wrap{padding:16px;max-width:900px;margin:auto}
    h2 { color: #0b3d1b; }
    .hud{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
    .badge{background:#174d2d;border:1px solid #2a6b43;color:#d7e3ff;padding:.35rem .6rem;border-radius:10px}
    .accent{color:#50fa7b}
    .btn{appearance:none;border:1px solid #2a6b43;background:#174d2d;color:#d7e3ff;border-radius:10px;padding:.5rem .8rem;font-weight:600;cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    .playfield{display:grid;grid-template-columns:1fr;gap:16px}
    .items{min-height:140px;padding:12px;border:2px dashed #2a6b43;border-radius:14px;display:flex;flex-wrap:wrap;gap:10px;background:rgba(16,64,32,.35)}
    .item{user-select:none;padding:.45rem .6rem;border-radius:12px;border:1px solid #2a6b43;background:linear-gradient(180deg,#1c4a2d,#14371f);color:#e9f1ff;font-weight:700;letter-spacing:.2px;display:inline-flex;align-items:center;gap:.45rem}
    .item[draggable="true"]{cursor:grab}
    .item:active{cursor:grabbing}
    .item .icon{width:26px;height:26px;object-fit:contain;background:#ffffff14;border-radius:6px;padding:2px;display:inline-block}
    .bins{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
    @media (max-width: 720px){.bins{grid-template-columns:repeat(2,1fr)}}
    .bin{border:2px solid #2a6b43;border-radius:14px;padding:10px;min-height:120px;background:linear-gradient(180deg,#1c4a2d,#14371f);display:flex;flex-direction:column}
    .bin header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .bin .drop{flex:1;min-height:90px}
    .bin .name{font-weight:800;  color: #ffffff;}
    .bin .emoji img{width:24px;height:24px;object-fit:contain}
    .bin.accept{outline:3px dashed #7fa3ff;outline-offset:2px}
    .bin.correct{box-shadow:0 0 0 2px #50fa7b inset}
    .bin.wrong{box-shadow:0 0 0 2px #ff6978 inset}
    .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .legend span{border:1px solid #2a6b43;border-radius:999px;padding:.2rem .5rem;font-size:.75rem;background:rgba(93,255,134,.08);color:#0b3d1b;font-weight:600}
    /* Responsive */
    @media (max-width: 600px){
      h2 { font-size: 1.2rem; }
      .bin .name { font-size: 0.85rem; }
      .item { font-size: 0.8rem; padding: .3rem .5rem; }
      .item .icon { width:20px; height:20px; }
    }
  </style>
</head>
<body>
  <div class="game-wrap">
    <h2>Juego: arrastra la basura al tacho correcto ♻️</h2>
    <div class="hud">
      <div class="badge">Puntaje: <span id="score" class="accent">0</span></div>
      <div class="badge">Intentos: <span id="attempts">0</span></div>
      <div class="badge">Restantes: <span id="remaining">0</span></div>
      <div class="badge">Tiempo: <span id="time">60</span>s</div>
      <button class="btn" id="btn-new">Nuevo juego</button>
    </div>

    <div class="playfield">
      <div class="items" id="items"></div>
      <div class="bins" id="bins"></div>
    </div>

    <div class="legend"></div>
  </div>

  <script>
    // --- sonidos (opcional; coloca tus archivos en /sounds) ---
    const sndSuccess = new Audio("sounds/success.mp3");
    const sndError   = new Audio("sounds/error.mp3");

    // --- cronómetro ---
    let time = 60;
    let timerInterval;

    function startTimer(){
      clearInterval(timerInterval);
      time = 60;
      document.getElementById("time").textContent = time;
      timerInterval = setInterval(()=>{
        time--;
        document.getElementById("time").textContent = time;
        if(time <= 0){
          clearInterval(timerInterval);
          alert(`⏰ Tiempo agotado. Puntaje final: ${score}`);
          newGame();
        }
      },1000);
    }

    // --- datos del juego ---
    const CATEGORIES = [
      { key:'papel',   name:'Papel y Cartón', img:'img/tacho_papel.png'},
      { key:'plastico',name:'Plástico',       img:'img/tacho_plastico.png'},
      { key:'vidrio',  name:'Vidrio',         img:'img/tacho_vidrio.png'},
      { key:'metal',   name:'Metal',          img:'img/tacho_metal.png'},
      { key:'organico',name:'Orgánico',       img:'img/tacho_organico.png'}
    ];

    const TYPE_COLORS = {papel:'#7fb3ff', plastico:'#ffd166', vidrio:'#80e7c0', metal:'#bdb2ff', organico:'#95d67b'};

    const POOL = [
      {label:'Botella PET',      type:'plastico', src:'img/botella.jpg'},
      {label:'Revista',          type:'papel',    src:'img/revista.png'},
      {label:'Lata de gaseosa',  type:'metal',    src:'img/lata_gaseosa.png'},
      {label:'Frasco de vidrio', type:'vidrio',   src:'img/frasco_vidrio.png'},
      {label:'Cáscara de plátano', type:'organico', src:'img/platano.png'},
      {label:'Caja de cartón',   type:'papel',    src:'img/caja_carton.png'},
      {label:'Tapita plástica',  type:'plastico', src:'img/tapas.png'},
      {label:'Botella de vidrio',type:'vidrio',   src:'img/vidrio.png'},
      {label:'Restos de comida', type:'organico', src:'img/comida.png'},
      {label:'Envase de yogur',  type:'plastico', src:'img/yogur.png'}
    ];

    // --- referencias UI ---
    const itemsEl = document.getElementById('items');
    const binsEl = document.getElementById('bins');
    const scoreEl = document.getElementById('score');
    const attemptsEl = document.getElementById('attempts');
    const remainingEl = document.getElementById('remaining');
    const btnNew = document.getElementById('btn-new');

    let score=0, attempts=0, remaining=0;

    function shuffle(arr){ return arr.sort(()=>Math.random()-.5); }

    function createBins(){
      binsEl.innerHTML='';
      CATEGORIES.forEach(cat=>{
        const bin = document.createElement('div');
        bin.className='bin';
        bin.dataset.accept = cat.key;
        bin.innerHTML = `<header><span class="emoji"><img src="${cat.img}" alt="${cat.name}"></span><span class="name">${cat.name}</span></header><div class="drop"></div>`;
        enableDrop(bin);
        binsEl.appendChild(bin);
      });
    }

    function createItems(){
      itemsEl.innerHTML='';
      const candidates = shuffle(POOL).slice(0,8);
      remaining = candidates.length; updateHUD();
      candidates.forEach(it=>{
        const el = document.createElement('div');
        el.className='item';
        el.draggable=true;
        el.dataset.type = it.type;
        const imgSrc = it.src || svgIcon(it.label, TYPE_COLORS[it.type] || '#6aa9ff');
        el.innerHTML = `<img class="icon" src="${imgSrc}" alt="${it.label}"> <span>${it.label}</span>`;
        enableDrag(el);
        itemsEl.appendChild(el);
      });
    }

    function enableDrag(el){
      el.addEventListener('dragstart', ()=> el.classList.add('dragging'));
      el.addEventListener('dragend', ()=> el.classList.remove('dragging'));
    }

    function enableDrop(bin){
      ['dragenter','dragover'].forEach(type=>{
        bin.addEventListener(type, e=>{e.preventDefault(); bin.classList.add('accept');});
      });
      ['dragleave','drop'].forEach(type=>{
        bin.addEventListener(type, ()=> bin.classList.remove('accept'));
      });
      bin.addEventListener('drop', e=>{
        e.preventDefault();
        const dragging = document.querySelector('.item.dragging');
        if(!dragging) return;
        const itemType = dragging.dataset.type;
        const accept = bin.dataset.accept;
        attempts++;
        if(itemType===accept){
          score += 10; remaining--; bin.classList.add('correct'); dragging.remove();
          try{ sndSuccess.play(); }catch(e){}
          setTimeout(()=>bin.classList.remove('correct'),500);
        }else{
          score = Math.max(0, score-3); bin.classList.add('wrong');
          try{ sndError.play(); }catch(e){}
          alert("⚠️ Ese residuo no corresponde a este tacho. Intenta de nuevo.");
          setTimeout(()=>bin.classList.remove('wrong'),500);
        }
        updateHUD();
        if(remaining===0) celebrate();
      });
    }

    function updateHUD(){
      scoreEl.textContent = score;
      attemptsEl.textContent = attempts;
      remainingEl.textContent = remaining;
    }

    function celebrate(){
      clearInterval(timerInterval);
      alert(`¡Buen trabajo! Clasificaste todos los residuos en ${60-time}s. Puntaje final: ${score}`);
      newGame();
    }

    function newGame(){
      score=0; attempts=0; remaining=0;
      updateHUD();
      createItems();
      startTimer(); // ¡no quitar!
    }

    function init(){
      createBins();
      newGame();
      btnNew.addEventListener('click', newGame);
      document.querySelector('.legend').innerHTML = CATEGORIES.map(c=>`<span><img src="${c.img}" alt="${c.name}" width="18"> ${c.name}</span>`).join('');
    }

    function svgIcon(text, bg){
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'>
        <rect rx='10' ry='10' width='64' height='64' fill='${bg}' />
        <text x='50%' y='54%' dominant-baseline='middle' text-anchor='middle' font-size='28' font-family='Arial,Helvetica,sans-serif' fill='white'>${(text||'?').slice(0,2)}</text>
      </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    init();
  </script>
</body>
</html>
